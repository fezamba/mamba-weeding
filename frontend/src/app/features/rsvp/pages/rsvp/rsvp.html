<div class="container">
  <mat-card class="rsvp-card">
    
    <mat-progress-bar mode="indeterminate" *ngIf="isLoading()"></mat-progress-bar>

    <mat-card-header>
      <mat-card-title>Fernando e Mariana</mat-card-title>
      <mat-card-subtitle>Confirmação de Presença</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      
      <div *ngIf="step() === 'search'" class="content-step fade-in">
        <p>Digite o código localizado no seu convite individual.</p>
        
        <form [formGroup]="lookupForm" (ngSubmit)="onLookup()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Código do Convite</mat-label>
            <input matInput formControlName="codigoConvite" placeholder="Ex: MAMBA2026" style="text-transform: uppercase;">
            <mat-icon matSuffix>confirmation_number</mat-icon>
            <mat-error *ngIf="lookupForm.get('codigoConvite')?.hasError('required')">
              O código é obrigatório
            </mat-error>
          </mat-form-field>

          <div class="actions-row">
            <button mat-flat-button color="primary" type="submit" [disabled]="lookupForm.invalid || isLoading()">
              BUSCAR CONVITE
            </button>
          </div>
        </form>
      </div>

      <div *ngIf="step() === 'form' && guestData()" class="content-step fade-in">
        <div class="guest-summary">
          <h3>Olá, {{ guestData()?.nomeCompleto }}</h3>
          <p>Status atual: <strong>{{ guestData()?.statusConvite || 'Pendente' }}</strong></p>
        </div>

        <form [formGroup]="actionForm" class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Email (Opcional)</mat-label>
            <input matInput type="email" formControlName="email" placeholder="exemplo@email.com">
            <mat-icon matSuffix>email</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>WhatsApp (Opcional)</mat-label>
            <input matInput type="tel" formControlName="telefone" placeholder="(00) 00000-0000">
            <mat-icon matSuffix>phone</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Mensagem aos noivos (opcional)</mat-label>
            <textarea matInput formControlName="observacoes" rows="3" placeholder="Restrições alimentares ou recados..."></textarea>
          </mat-form-field>
        </form>

        <div class="actions-buttons">
          <button mat-flat-button color="primary" (click)="submitRsvp(true)" [disabled]="isLoading()">
            CONFIRMAR PRESENÇA
          </button>
          <button mat-stroked-button color="warn" (click)="submitRsvp(false)" [disabled]="isLoading()">
            NÃO PODEREI IR
          </button>
          <button mat-button (click)="resetSearch()">Voltar</button>
        </div>
      </div>

      <div *ngIf="step() === 'success'" class="content-step fade-in">
        <div class="success-message">
          <mat-icon class="large-icon">check_circle</mat-icon>
          <h3>Obrigado!</h3>
          <p>Sua resposta foi registrada com sucesso.</p>
        </div>
        <div class="actions-row">
          <button mat-stroked-button (click)="resetSearch()">Voltar ao início</button>
        </div>
      </div>

    </mat-card-content>
  </mat-card>
</div>